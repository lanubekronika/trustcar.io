<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Your Inspection Report ‚Äî TrustCar.io</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 0; font-family: 'Nunito', system-ui, sans-serif; background: #f5f8fa; color: #0b1724; }
        header { background: linear-gradient(135deg, #0553F0 0%, #0441c7 100%); color: white; padding: 1.5rem 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(5,83,240,0.15); }
        .logo { font-size: 1.8rem; font-weight: 800; cursor: pointer; transition: opacity .2s; }
        .logo:hover { opacity: 0.85; }
        main { padding: 3rem 5%; max-width: 600px; margin: 0 auto; }
        .card { background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border-radius: 16px; padding: 2.5rem; box-shadow: 0 8px 24px rgba(2,6,23,0.1); border: 2px solid #e6eefc; }
        h1 { font-size: 2.2rem; margin: 0 0 1rem 0; text-align: center; font-weight: 800; }
        .subtitle { color: #64748b; text-align: center; margin-bottom: 2rem; line-height: 1.6; font-weight: 500; }
        label { display: block; font-weight: 700; margin-bottom: .5rem; font-size: .95rem; color: #0553F0; }
        input { width: 100%; padding: 1rem 1.25rem; border: 2px solid #e6eefc; border-radius: 12px; font-size: 1rem; font-family: inherit; outline: none; background: white; transition: all .2s; }
        input:focus { border-color: #0553F0; box-shadow: 0 4px 12px rgba(5,83,240,0.15); transform: translateY(-1px); }
        .btn { width: 100%; padding: 1rem; background: linear-gradient(135deg, #0553F0 0%, #0441c7 100%); color: white; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 700; cursor: pointer; margin-top: 1.5rem; transition: all .2s; box-shadow: 0 4px 12px rgba(5,83,240,0.25); }
        .btn:hover { background: linear-gradient(135deg, #0441c7 0%, #033ba3 100%); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(5,83,240,0.35); }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; transform: none; box-shadow: none; }
        .error-msg { background: linear-gradient(135deg, #fee 0%, #fdd 100%); color: #c00; padding: .75rem 1rem; border-radius: 10px; margin-top: 1rem; display: none; font-size: .9rem; border: 2px solid #fcc; font-weight: 600; }
        .error-msg.show { display: block; }
        .info-box { background: linear-gradient(135deg, #e6f4ff 0%, #d1e9ff 100%); border: 2px solid #0553F0; border-radius: 12px; padding: 1.5rem; margin-top: 2rem; }
        .info-box h3 { margin: 0 0 .75rem 0; color: #0553F0; font-size: 1.05rem; font-weight: 800; }
        .info-box ul { margin: .5rem 0 0 1.5rem; padding: 0; }
        .info-box li { margin: .5rem 0; color: #475569; font-size: .95rem; font-weight: 500; }
        .help-text { text-align: center; margin-top: 1.5rem; color: #64748b; font-size: .9rem; }
        .help-text a { color: #0553F0; text-decoration: none; font-weight: 600; }
        .help-text a:hover { text-decoration: underline; }
        @media (max-width: 640px) {
            main { padding: 2rem 3%; }
            .card { padding: 1.75rem; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo" onclick="window.location.href='/'">TrustCar.io</div>
    </header>

    <main>
        <div class="card">
            <h1>üîç View Your Inspection Report</h1>
            <p class="subtitle">Enter your Inspection ID to access your complete vehicle inspection report, photos, damage analysis, and AI assistant.</p>

            <form id="reportForm">
                <label for="inspectionId">Inspection ID</label>
                <input 
                    type="text" 
                    id="inspectionId" 
                    name="inspectionId" 
                    placeholder="e.g., abc12345-6789-def0-1234-567890abcdef"
                    required
                    autocomplete="off"
                />

                <div class="error-msg" id="errorMsg"></div>

                <button type="submit" class="btn" id="submitBtn">View My Report</button>
            </form>

            <div class="info-box">
                <h3>üìã Your Report Includes:</h3>
                <ul>
                    <li>Complete 20-photo inspection checklist</li>
                    <li>AI damage detection & 360¬∞ damage map</li>
                    <li>Reconditioning cost estimates</li>
                    <li>Fraud risk analysis & title history</li>
                    <li>AI assistant to answer your questions</li>
                </ul>
            </div>

            <p class="help-text">
                Don't have your Inspection ID? <a href="mailto:support@trustcar.io">Contact Support</a>
            </p>
        </div>
    </main>

    <script>
        const form = document.getElementById('reportForm');
        const input = document.getElementById('inspectionId');
        const submitBtn = document.getElementById('submitBtn');
        const errorMsg = document.getElementById('errorMsg');

        // Pre-fill if ID in URL
        const urlParams = new URLSearchParams(window.location.search);
        const urlId = urlParams.get('id');
        if (urlId) {
            input.value = urlId;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMsg.classList.remove('show');
            
            const inspectionId = input.value.trim();
            if (!inspectionId) {
                showError('Please enter an Inspection ID');
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Loading...';

            try {
                // Verify inspection exists
                const response = await fetch(`/api/inspections/${inspectionId}`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        showError('Inspection ID not found. Please check and try again.');
                    } else {
                        showError('Unable to load report. Please try again later.');
                    }
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'View My Report';
                    return;
                }

                const data = await response.json();
                
                // Check if inspection is completed
                if (data.inspection.status !== 'completed') {
                    showError('Your inspection is still being processed. Please check back in 24-48 hours or check your email for updates.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'View My Report';
                    return;
                }

                // Redirect to full report page
                window.location.href = `/buyer-report.html?id=${inspectionId}`;

            } catch (error) {
                console.error('Error:', error);
                showError('Connection error. Please check your internet and try again.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'View My Report';
            }
        });

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.add('show');
        }
    </script>
</body>
</html>
